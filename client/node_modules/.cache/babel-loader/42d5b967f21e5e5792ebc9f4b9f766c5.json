{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _redboxReact2 = require('redbox-react');\n\nvar _redboxReact3 = _interopRequireDefault(_redboxReact2);\n\nvar _reactTransformCatchErrors3 = require('react-transform-catch-errors');\n\nvar _reactTransformCatchErrors4 = _interopRequireDefault(_reactTransformCatchErrors3);\n\nvar _react2 = require('react');\n\nvar _react3 = _interopRequireDefault(_react2);\n\nvar _reactTransformHmr3 = require('react-transform-hmr');\n\nvar _reactTransformHmr4 = _interopRequireDefault(_reactTransformHmr3);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _class, _temp;\n\nvar _propTypes = require('prop-types');\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar _components = {\n  Knob: {\n    displayName: 'Knob'\n  }\n};\n\nvar _reactTransformHmr2 = (0, _reactTransformHmr4.default)({\n  filename: 'Knob.js',\n  components: _components,\n  locals: [module],\n  imports: [_react3.default]\n});\n\nvar _reactTransformCatchErrors2 = (0, _reactTransformCatchErrors4.default)({\n  filename: 'Knob.js',\n  components: _components,\n  locals: [],\n  imports: [_react3.default, _redboxReact3.default]\n});\n\nfunction _wrapComponent(id) {\n  return function (Component) {\n    return _reactTransformHmr2(_reactTransformCatchErrors2(Component, id), id);\n  };\n}\n\nvar Knob = _wrapComponent('Knob')((_temp = _class = function (_React$Component) {\n  _inherits(Knob, _React$Component);\n\n  function Knob(props) {\n    _classCallCheck(this, Knob);\n\n    var _this = _possibleConstructorReturn(this, (Knob.__proto__ || Object.getPrototypeOf(Knob)).call(this, props));\n\n    _this.getArcToValue = function (v) {\n      var startAngle = void 0;\n      var endAngle = void 0;\n      var angle = !_this.props.log ? (v - _this.props.min) * _this.angleArc / (_this.props.max - _this.props.min) : Math.log(Math.pow(v / _this.props.min, _this.angleArc)) / Math.log(_this.props.max / _this.props.min);\n\n      if (!_this.props.clockwise) {\n        startAngle = _this.endAngle + 0.00001;\n        endAngle = startAngle - angle - 0.00001;\n      } else {\n        startAngle = _this.startAngle - 0.00001;\n        endAngle = startAngle + angle + 0.00001;\n      }\n\n      if (_this.props.cursor) {\n        startAngle = endAngle - _this.cursorExt;\n        endAngle += _this.cursorExt;\n      }\n\n      return {\n        startAngle: startAngle,\n        endAngle: endAngle,\n        acw: !_this.props.clockwise && !_this.props.cursor\n      };\n    };\n\n    _this.getCanvasScale = function (ctx) {\n      var devicePixelRatio = window.devicePixelRatio || window.screen.deviceXDPI / window.screen.logicalXDPI || // IE10\n      1;\n      var backingStoreRatio = ctx.webkitBackingStorePixelRatio || 1;\n      return devicePixelRatio / backingStoreRatio;\n    };\n\n    _this.coerceToStep = function (v) {\n      var val = !_this.props.log ? ~~((v < 0 ? -0.5 : 0.5) + v / _this.props.step) * _this.props.step : Math.pow(_this.props.step, ~~((Math.abs(v) < 1 ? -0.5 : 0.5) + Math.log(v) / Math.log(_this.props.step)));\n      val = Math.max(Math.min(val, _this.props.max), _this.props.min);\n\n      if (isNaN(val)) {\n        val = 0;\n      }\n\n      return Math.round(val * 1000) / 1000;\n    };\n\n    _this.eventToValue = function (e) {\n      var bounds = _this.canvasRef.getBoundingClientRect();\n\n      var x = e.clientX - bounds.left;\n      var y = e.clientY - bounds.top;\n\n      var a = Math.atan2(x - _this.w / 2, _this.w / 2 - y) - _this.angleOffset;\n\n      if (!_this.props.clockwise) {\n        a = _this.angleArc - a - 2 * Math.PI;\n      }\n\n      if (_this.angleArc !== Math.PI * 2 && a < 0 && a > -0.5) {\n        a = 0;\n      } else if (a < 0) {\n        a += Math.PI * 2;\n      }\n\n      var val = !_this.props.log ? a * (_this.props.max - _this.props.min) / _this.angleArc + _this.props.min : Math.pow(_this.props.max / _this.props.min, a / _this.angleArc) * _this.props.min;\n      return _this.coerceToStep(val);\n    };\n\n    _this.handleMouseDown = function (e) {\n      _this.props.onChange(_this.eventToValue(e));\n\n      document.addEventListener('mousemove', _this.handleMouseMove);\n      document.addEventListener('mouseup', _this.handleMouseUp);\n      document.addEventListener('keyup', _this.handleEsc);\n    };\n\n    _this.handleMouseMove = function (e) {\n      e.preventDefault();\n\n      _this.props.onChange(_this.eventToValue(e));\n    };\n\n    _this.handleMouseUp = function (e) {\n      _this.props.onChangeEnd(_this.eventToValue(e));\n\n      document.removeEventListener('mousemove', _this.handleMouseMove);\n      document.removeEventListener('mouseup', _this.handleMouseUp);\n      document.removeEventListener('keyup', _this.handleEsc);\n    };\n\n    _this.handleTouchStart = function (e) {\n      e.preventDefault();\n      _this.touchIndex = e.targetTouches.length - 1;\n\n      _this.props.onChange(_this.eventToValue(e.targetTouches[_this.touchIndex]));\n\n      document.addEventListener('touchmove', _this.handleTouchMove, {\n        passive: false\n      });\n      document.addEventListener('touchend', _this.handleTouchEnd);\n      document.addEventListener('touchcancel', _this.handleTouchEnd);\n    };\n\n    _this.handleTouchMove = function (e) {\n      e.preventDefault();\n\n      _this.props.onChange(_this.eventToValue(e.targetTouches[_this.touchIndex]));\n    };\n\n    _this.handleTouchEnd = function (e) {\n      _this.props.onChangeEnd(_this.eventToValue(e));\n\n      document.removeEventListener('touchmove', _this.handleTouchMove);\n      document.removeEventListener('touchend', _this.handleTouchEnd);\n      document.removeEventListener('touchcancel', _this.handleTouchEnd);\n    };\n\n    _this.handleEsc = function (e) {\n      if (e.keyCode === 27) {\n        e.preventDefault();\n\n        _this.handleMouseUp();\n      }\n    };\n\n    _this.handleTextInput = function (e) {\n      var val = Math.max(Math.min(+e.target.value, _this.props.max), _this.props.min) || _this.props.min;\n\n      _this.props.onChange(val);\n    };\n\n    _this.handleWheel = function (e) {\n      e.preventDefault();\n\n      if (e.deltaX > 0 || e.deltaY > 0) {\n        _this.props.onChange(_this.coerceToStep(!_this.props.log ? _this.props.value + _this.props.step : _this.props.value * _this.props.step));\n      } else if (e.deltaX < 0 || e.deltaY < 0) {\n        _this.props.onChange(_this.coerceToStep(!_this.props.log ? _this.props.value - _this.props.step : _this.props.value / _this.props.step));\n      }\n    };\n\n    _this.handleArrowKey = function (e) {\n      if (e.keyCode === 37 || e.keyCode === 40) {\n        e.preventDefault();\n\n        _this.props.onChange(_this.coerceToStep(!_this.props.log ? _this.props.value - _this.props.step : _this.props.value / _this.props.step));\n      } else if (e.keyCode === 38 || e.keyCode === 39) {\n        e.preventDefault();\n\n        _this.props.onChange(_this.coerceToStep(!_this.props.log ? _this.props.value + _this.props.step : _this.props.value * _this.props.step));\n      }\n    };\n\n    _this.inputStyle = function () {\n      return {\n        width: (_this.w / 2 + 4 >> 0) + 'px',\n        height: (_this.w / 3 >> 0) + 'px',\n        position: 'absolute',\n        verticalAlign: 'middle',\n        marginTop: (_this.w / 3 >> 0) + 'px',\n        marginLeft: '-' + (_this.w * 3 / 4 + 2 >> 0) + 'px',\n        border: 0,\n        background: 'none',\n        font: _this.props.fontWeight + ' ' + (_this.w / _this.digits >> 0) + 'px ' + _this.props.font,\n        textAlign: 'center',\n        color: _this.props.inputColor || _this.props.fgColor,\n        padding: '0px',\n        WebkitAppearance: 'none'\n      };\n    };\n\n    _this.renderCenter = function () {\n      var _this$props = _this.props,\n          displayCustom = _this$props.displayCustom,\n          displayInput = _this$props.displayInput,\n          disableTextInput = _this$props.disableTextInput,\n          readOnly = _this$props.readOnly,\n          value = _this$props.value;\n\n      if (displayInput) {\n        return _react3.default.createElement('input', {\n          style: _this.inputStyle(),\n          type: 'text',\n          value: value,\n          onChange: _this.handleTextInput,\n          onKeyDown: _this.handleArrowKey,\n          readOnly: readOnly || disableTextInput\n        });\n      } else if (displayCustom && typeof displayCustom === 'function') {\n        return displayCustom();\n      }\n\n      return null;\n    };\n\n    _this.w = _this.props.width || 200;\n    _this.h = _this.props.height || _this.w;\n    _this.cursorExt = _this.props.cursor === true ? 0.3 : _this.props.cursor / 100;\n    _this.angleArc = _this.props.angleArc * Math.PI / 180;\n    _this.angleOffset = _this.props.angleOffset * Math.PI / 180;\n    _this.startAngle = 1.5 * Math.PI + _this.angleOffset;\n    _this.endAngle = 1.5 * Math.PI + _this.angleOffset + _this.angleArc;\n    _this.digits = Math.max(String(Math.abs(_this.props.min)).length, String(Math.abs(_this.props.max)).length, 2) + 2;\n    return _this;\n  }\n\n  _createClass(Knob, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.drawCanvas();\n\n      if (!this.props.readOnly) {\n        this.canvasRef.addEventListener('touchstart', this.handleTouchStart, {\n          passive: false\n        });\n      }\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps(nextProps) {\n      if (nextProps.width && this.w !== nextProps.width) {\n        this.w = nextProps.width;\n      }\n\n      if (nextProps.height && this.h !== nextProps.height) {\n        this.h = nextProps.height;\n      }\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this.drawCanvas();\n    }\n  }, {\n    key: 'componentWillUnmount',\n    value: function componentWillUnmount() {\n      this.canvasRef.removeEventListener('touchstart', this.handleTouchStart);\n    } // Calculate ratio to scale canvas to avoid blurriness on HiDPI devices\n\n  }, {\n    key: 'drawCanvas',\n    value: function drawCanvas() {\n      var ctx = this.canvasRef.getContext('2d');\n      var scale = this.getCanvasScale(ctx);\n      this.canvasRef.width = this.w * scale; // clears the canvas\n\n      this.canvasRef.height = this.h * scale;\n      ctx.scale(scale, scale);\n      this.xy = this.w / 2; // coordinates of canvas center\n\n      this.lineWidth = this.xy * this.props.thickness;\n      this.radius = this.xy - this.lineWidth / 2;\n      ctx.lineWidth = this.lineWidth;\n      ctx.lineCap = this.props.lineCap; // background arc\n\n      ctx.beginPath();\n      ctx.strokeStyle = this.props.bgColor;\n      ctx.arc(this.xy, this.xy, this.radius, this.endAngle - 0.00001, this.startAngle + 0.00001, true);\n      ctx.stroke(); // foreground arc\n\n      var a = this.getArcToValue(this.props.value);\n      ctx.beginPath();\n      ctx.strokeStyle = this.props.fgColor;\n      ctx.arc(this.xy, this.xy, this.radius, a.startAngle, a.endAngle, a.acw);\n      ctx.stroke();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props = this.props,\n          canvasClassName = _props.canvasClassName,\n          className = _props.className,\n          disableMouseWheel = _props.disableMouseWheel,\n          readOnly = _props.readOnly,\n          title = _props.title,\n          value = _props.value;\n      return _react3.default.createElement('div', {\n        className: className,\n        style: {\n          width: this.w,\n          height: this.h,\n          display: 'inline-block'\n        },\n        onWheel: readOnly || disableMouseWheel ? null : this.handleWheel\n      }, _react3.default.createElement('canvas', {\n        ref: function ref(_ref) {\n          _this2.canvasRef = _ref;\n        },\n        className: canvasClassName,\n        style: {\n          width: '100%',\n          height: '100%'\n        },\n        onMouseDown: readOnly ? null : this.handleMouseDown,\n        title: title ? title + ': ' + value : value\n      }), this.renderCenter());\n    }\n  }]);\n\n  return Knob;\n}(_react3.default.Component), _class.propTypes = {\n  value: _propTypes2.default.number.isRequired,\n  onChange: _propTypes2.default.func.isRequired,\n  onChangeEnd: _propTypes2.default.func,\n  min: _propTypes2.default.number,\n  max: _propTypes2.default.number,\n  step: _propTypes2.default.number,\n  log: _propTypes2.default.bool,\n  width: _propTypes2.default.number,\n  height: _propTypes2.default.number,\n  thickness: _propTypes2.default.number,\n  lineCap: _propTypes2.default.oneOf(['butt', 'round']),\n  bgColor: _propTypes2.default.string,\n  fgColor: _propTypes2.default.string,\n  inputColor: _propTypes2.default.string,\n  font: _propTypes2.default.string,\n  fontWeight: _propTypes2.default.string,\n  clockwise: _propTypes2.default.bool,\n  cursor: _propTypes2.default.oneOfType([_propTypes2.default.number, _propTypes2.default.bool]),\n  stopper: _propTypes2.default.bool,\n  readOnly: _propTypes2.default.bool,\n  disableTextInput: _propTypes2.default.bool,\n  displayInput: _propTypes2.default.bool,\n  displayCustom: _propTypes2.default.func,\n  angleArc: _propTypes2.default.number,\n  angleOffset: _propTypes2.default.number,\n  disableMouseWheel: _propTypes2.default.bool,\n  title: _propTypes2.default.string,\n  className: _propTypes2.default.string,\n  canvasClassName: _propTypes2.default.string\n}, _class.defaultProps = {\n  onChangeEnd: function onChangeEnd() {},\n  min: 0,\n  max: 100,\n  step: 1,\n  log: false,\n  width: 200,\n  height: 200,\n  thickness: 0.35,\n  lineCap: 'butt',\n  bgColor: '#EEE',\n  fgColor: '#EA2',\n  inputColor: '',\n  font: 'Arial',\n  fontWeight: 'bold',\n  clockwise: true,\n  cursor: false,\n  stopper: true,\n  readOnly: false,\n  disableTextInput: false,\n  displayInput: true,\n  angleArc: 360,\n  angleOffset: 0,\n  disableMouseWheel: false,\n  className: null,\n  canvasClassName: null\n}, _temp));\n\nexports.default = Knob;","map":null,"metadata":{},"sourceType":"script"}